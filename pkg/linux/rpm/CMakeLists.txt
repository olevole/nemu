set(CPACK_GENERATOR "RPM")
set(CPACK_PACKAGE_NAME "nemu")
set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "nEMU - ncurses interface for QEMU")
set(CPACK_PACKAGE_DESCRIPTION_FILE "${CMAKE_CURRENT_SOURCE_DIR}/DESCRIPTION")
set(CPACK_PACKAGE_RELEASE 1)
set(CPACK_PACKAGING_INSTALL_PREFIX /usr)
set(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION}-${CPACK_PACKAGE_RELEASE}.${CMAKE_SYSTEM_PROCESSOR}")

if(NOT CPACK_PACKAGE_VERSION)
    set(CPACK_PACKAGE_VERSION ${GIT_TAG_VERSION})
endif()

set(
    CPACK_RPM_SOURCE_PKG_BUILD_PARAMS
    "-DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} "
    "-DNM_CUSTOM_SYS_INCLUDE=${NM_CUSTOM_SYS_INCLUDE} "
    "-DNM_WITH_OVF_SUPPORT=${NM_WITH_OVF_SUPPORT} "
    "-DNM_SAVEVM_SNAPSHOTS=${NM_SAVEVM_SNAPSHOTS} "
    "-DNM_WITH_VNC_CLIENT=${NM_WITH_VNC_CLIENT} "
    "-DNM_WITH_SPICE=${NM_WITH_SPICE} "
    "-DNM_WITH_NETWORK_MAP=${NM_WITH_NETWORK_MAP} "
    "-DNM_WITH_DBUS=${NM_WITH_DBUS} "
    "-DCPACK_PACKAGE_VERSION=${CPACK_PACKAGE_VERSION}"
)

set(CPACK_RPM_PACKAGE_LICENSE "BSD-2-clause")
set(CPACK_RPM_PACKAGE_GROUP "Applications/Emulators")
set(CPACK_RPM_PACKAGE_URL "https://github.com/nemuTUI/nemu")
set(CPACK_RPM_PACKAGE_VENDOR "Boris Stepanenko <boris.stepanenko@gmail.com>")
set(CPACK_RPM_PACKAGE_AUTOREQ 1)
set(CPACK_RPM_POST_INSTALL_SCRIPT_FILE "${CMAKE_CURRENT_SOURCE_DIR}/postinstall.sh")
set(CPACK_RPM_POST_UNINSTALL_SCRIPT_FILE "${CMAKE_CURRENT_SOURCE_DIR}/postuninstall.sh")

list(APPEND CPACK_RPM_EXCLUDE_FROM_AUTO_FILELIST_ADDITION "/usr/share/locale")
list(APPEND CPACK_RPM_EXCLUDE_FROM_AUTO_FILELIST_ADDITION "/usr/share/locale/ru")
list(APPEND CPACK_RPM_EXCLUDE_FROM_AUTO_FILELIST_ADDITION "/usr/share/locale/ru/LC_MESSAGES")
list(APPEND CPACK_RPM_EXCLUDE_FROM_AUTO_FILELIST_ADDITION "/usr/share/bash-completion")
list(APPEND CPACK_RPM_EXCLUDE_FROM_AUTO_FILELIST_ADDITION "/usr/share/bash-completion/completions")
list(APPEND CPACK_RPM_EXCLUDE_FROM_AUTO_FILELIST_ADDITION "/usr/share/bash-completion/completions/nemu")

include(CPack)
